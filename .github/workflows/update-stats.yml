name: Update Monkeytype Stats

on:
  schedule:
    - cron: '0 */6 * * *' # 6시간마다 실행
  workflow_dispatch: # 수동 실행 가능

jobs:
  update-stats:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'

      - name: Run Generator
        # ⭐ 핵심: 사용자가 변수(Vars)를 설정했으면 그걸 쓰고, 없으면 깃허브 아이디를 씀
        env:
          # Settings -> Secrets and variables -> Variables 에서 설정한 값
          MT_USERNAME: ${{ vars.MT_USERNAME || github.repository_owner }}
          MT_THEME: ${{ vars.MT_THEME || 'serika_dark' }}
          MT_MODE: ${{ vars.MT_MODE || 'time' }}
          MT_LENGTH: ${{ vars.MT_LENGTH || '60' }}
        run: |
          echo "Generating stats for User: $MT_USERNAME / Theme: $MT_THEME"
          go run main.go -username="$MT_USERNAME" -theme="$MT_THEME" -mode="$MT_MODE" -length="$MT_LENGTH"

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add stats.svg
          # 변경사항이 없으면 에러 안 내고 넘어감
          git commit -m "Update monkeytype stats" || exit 0
          git push